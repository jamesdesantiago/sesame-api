name: CI

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #
# â†ª When does it run?
#   â€¢ Every push (all branches) â€“ so direct commits to `main`
#     still get validated.
#   â€¢ All pull-requests.
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #
on:
  push:
  pull_request:
  workflow_dispatch:        # optional â€œRun workflowâ€ button in the UI

# Prevent two runs from fighting over the same branch / PR.
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #
  # Lint, type-check, test
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #
  tests:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    # Matrix lets you add more Python versions later with one line.
    strategy:
      matrix:
        python-version: ["3.10"]

    steps:
      - name: â¬‡ï¸  Checkout code
        uses: actions/checkout@v4

      # ---------- Python ----------
      - name: ğŸ”§ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          cache: "pip"             # automatic ~//.cache/pip caching

      - name: ğŸ“¦ Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
          # Dev-only tools (lint, type, test)
          pip install black==24.2.0 isort==5.13.2 flake8==7.0.0 mypy==1.10.0 \
                      pytest==8.2.0 pytest-cov==5.0.0

      # ---------- Static checks ----------
      - name: ğŸ” Black formatting (check-only)
        run: black --check app tests main.py

      - name: ğŸ” isort import ordering (check-only)
        run: isort --check --diff app tests main.py

      - name: ğŸ” Flake8 lint
        run: flake8 app tests main.py

      # If youâ€™re not ready for mypy, comment this step out.
      - name: ğŸ” mypy type-checking
        run: mypy app

      # ---------- Tests ----------
      - name: ğŸ§ª Run pytest
        run: |
          pytest -q --cov=app --cov-report=xml
        env:
          # Any environment vars your tests need can go here
          ENVIRONMENT: test

      # ---------- Upload coverage to PR (optional) ----------
      # Requires a free codecov.io or coveralls.io account & repo token.
      # - name: Upload coverage report
      #   uses: codecov/codecov-action@v4
      #   with:
      #     file: coverage.xml
